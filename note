<td>
                                <form method="POST" action="{{ route('appointment.update', $appointment->id) }}" style="display:inline;">
                                    @csrf
                                    @method('PUT')
                                    <input type="hidden" name="service_id" value="{{ $appointment->service_id }}">
                                    <input type="hidden" name="staff_id" value="{{ $appointment->staff_id }}">
                                    <input type="hidden" name="appointment_date" value="{{ $appointment->appointment_date }}">
                                    <input type="hidden" name="start_time" value="{{ $appointment->start_time }}">
                                    <select name="status" class="form-select form-select-sm" onchange="this.form.submit()" style="width:auto;display:inline;">
                                        <option value="pending" {{ $appointment->status == 'pending' ? 'selected' : '' }}>Pending</option>
                                        <option value="confirmed" {{ $appointment->status == 'confirmed' ? 'selected' : '' }}>Confirmed</option>
                                        <option value="cancelled" {{ $appointment->status == 'cancelled' ? 'selected' : '' }}>Cancelled</option>
                                        <option value="completed" {{ $appointment->status == 'completed' ? 'selected' : '' }}>Completed</option>
                                    </select>
                                </form>
                            </td>





@extends('masterpage.layout')

@section('title', 'Staff Availability')

@section('mainConten')
<div class="dash-container">
    <div class="dash-content">
        <div class="page-header">
            <h4>Manage Availability</h4>
        </div>

  
        <div class="card">
            <div class="card-body">
                <form method="POST" action="{{ route('staff.store') }}">
                    @csrf
                    
                    @foreach(['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'] as $day)
                    <div class="mb-3">
                        <h6>{{ ucfirst($day) }}</h6>
                        <input type="checkbox" name="availability[{{ $day }}][available]" value="1" 
                            {{ $availability && isset($availability->availability[$day]['available']) && $availability->availability[$day]['available'] ? 'checked' : '' }}>
                        <label>Available</label>
                        
                        <div class="row mt-2">
                            <div class="col-md-3">
                                <input type="time" class="form-control" 
                                    name="availability[{{ $day }}][start_time]" 
                                    value="{{ $availability->availability[$day]['start_time'] ?? '' }}">
                            </div>
                            <div class="col-md-3">
                                <input type="time" class="form-control" 
                                    name="availability[{{ $day }}][end_time]" 
                                    value="{{ $availability->availability[$day]['end_time'] ?? '' }}">
                            </div>
                        </div>
                    </div>
                    @endforeach

                    <button type="submit" class="btn btn-primary">Save Availability</button>
                </form>
            </div>
        </div>
    </div>
</div>
@endsection





    public function index()
    {
        $availability = Staff::where('user_id', Auth::id())->first();
        return view('staff.staff_availability', compact('availability'));
    }


    public function store(Request $request)
    {
        $request->validate([
            'availability' => 'required|array',
        ]);

        $availability = [];
        foreach ($request->availability as $day => $data) {
            $availability[$day] = [
                'available' => isset($data['available']),
                'start_time' => $data['start_time'] ?? null,
                'end_time' => $data['end_time'] ?? null,
            ];
        }

        Staff::updateOrCreate(
            ['user_id' => Auth::id()],
            ['availability' => $availability]
        );

        return redirect()->back()->with('success', 'Availability updated successfully');
    }




@if (session('success') || session('error'))
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1100">
    <div id="liveToast"
        class="toast align-items-center text-white 
        {{ session('success') ? 'bg-success' : 'bg-danger' }} 
        border-0 show"
        role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                {{ session('success') ?? session('error') }}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto"
                data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        let toastEl = document.getElementById('liveToast');
        if (toastEl) {
            let toast = new bootstrap.Toast(toastEl, {
                delay: 3000 
            });
            toast.show();
        }
    });
</script>
@endif
